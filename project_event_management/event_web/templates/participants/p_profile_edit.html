{% extends "layout.html" %}
{% load widget_tweaks %}

{% block title %}
Profile_edit
{% endblock %}

{% block content %}
<a href="{% url 'url_profile' %}" class="btn_back"><b>Back</b></a>
<div class="main_profile text-center">
    <div class="ex3">
        <h2 class="ghost text-center mt-4" style="color: white;">Edit Profile</h2>
    </div>
</div>
<div class="d-flex justify-content-center">
    <div class="profile_edit mb-5" style="width: 100%; max-width: 600px;">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <div class="row">
                    <div class="col">
                        <div class="box_edit_user">
                            <h5>First Name :</h5>
                            {{ form2.first_name|add_class:'form_profile_edit' }}
                        </div>
                    </div>
                    <div class="col">
                        <div class="box_edit_user">
                            <h5>Last Name :</h5>
                            {{ form2.last_name|add_class:'form_profile_edit' }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-3 box_edit_user">
                <h5>Email :</h5>
                {{ form2.email|add_class:'form_profile_edit' }}
            </div>
            <div class="mb-3 box_edit_user">
                <h5>Phone :</h5>
                {{ form2.phone_number|add_class:'form_profile_edit' }}
            </div>
            <div class="mb-3 box_edit_user">
                <h5>Gender :</h5>
                {{ form1.gender|add_class:'form_profile_edit' }}
            </div>
            <div class="mb-3">
                <div class="row">
                    <div class="col">
                        <div class="box_edit_user">
                            <h5>Age :</h5>
                            {{ form1.age|add_class:'form_profile_edit' }}
                        </div>
                    </div>
                    <div class="col">
                        <div class="box_edit_user">
                            <h5>Birthday :</h5>
                            {{ form1.birthday|add_class:'form_profile_edit' }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-3 box_edit_user">
                <label for="id_upload_image" class="form-label">Upload Profile Image</label>
                <input class="form-control" type="file" id="id_upload_image" name="upload_profile"/>
                <div class="form-text">You can upload only 1 image.</div>
            </div>
            {% if form.errors %}
            <div class="login_error_box">
                {{ form1.errors }}
                {{ form2.errors }}
            </div>
            {% endif %}
            <div class="mt-4 text-end">
                <button type="submit" class="btn_profile me-2" onclick="return confirm('คุณต้องการแก้ไขข้อมูลนี้หรือไม่?');"><b>Save Changes</b></button>
                <a href="{% url 'url_profile' %}" class="btn_edit_user" style="padding: 9px;"><b>Cancel</b></a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    document
    .getElementById("id_upload_image")
    .addEventListener("change", function (event) {
      const uploadField = document.getElementById("id_upload_image"); // เลือกฟิลด์สำหรับการอัปโหลดไฟล์
      const allowedTypes = [
        "image/jpeg",
        "image/png",
        "image/gif",
        "image/webp",
        "image/jpg"
      ]; // ประเภทไฟล์ที่อนุญาต

      // ตรวจสอบว่าผู้ใช้อัปโหลดไฟล์หรือไม่
      if (uploadField.files.length > 0) {
        const file = uploadField.files[0]; // เข้าถึงไฟล์ที่อัปโหลด

        // ตรวจสอบ MIME type ของไฟล์
        if (!allowedTypes.includes(file.type)) {
          alert(
            "File type is not supported. Please upload JPEG, PNG, GIF, or WEBP files."
          );
          uploadField.value = ""; // ล้างค่าไฟล์ที่ไม่ถูกต้อง
          return false;
        }
      }
    });
</script>
{% endblock %}